<!DOCTYPE html>
<html lang="en">
   <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1KP1G29V5Y"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-1KP1G29V5Y');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="QueryJSON - Transform, query, and explore JSON/XML/CSV data with an interactive table viewer and SQL queries powered by PGLite">
    <meta name="keywords" content="json, xml, csv, table, converter, sql, query, pglite, json viewer, json explorer, xml to json, csv to json">
    <meta name="author" content="Dinesh D">
    <title>QueryJSON - JSON/XML/CSV to Table Converter & Query Tool</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="static/images/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="static/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="static/images/apple-touch-icon.png">
    <link rel="manifest" href="static/images/site.webmanifest">

    <!-- PGLite - PostgreSQL in the browser -->
    <script type="module">
        import { PGlite } from 'https://cdn.jsdelivr.net/npm/@electric-sql/pglite/dist/index.js';
        window.PGlite = PGlite;
    </script>

    <!-- JSONPath library - using a simpler, more reliable library -->
    <script src="https://cdn.jsdelivr.net/npm/jsonpath@1.1.1/jsonpath.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="static/css/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><img src="static/images/favicon-32x32.png" alt="QueryJSON" style="vertical-align: middle; margin-right: 8px; width: 20px; height: 20px;"> QueryJSON</h1>
        </div>

        <div class="section-header">
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 8px 12px;">
                <h2 style="margin: 0; font-size: 12px; color: var(--accent-primary); text-transform: uppercase;"><span class="section-icon"></span> INPUT • CHOOSE COLUMNS • FILTER</h2>
                <button class="toggle-text-btn" id="topSectionToggle" onclick="toggleTopSection()">Hide Section</button>
            </div>
        </div>

        <div class="main-grid" id="topSection">
            <!-- Input Panel -->
            <div class="panel" style="display: flex; flex-direction: column;">
                <h2><span class="section-icon"></span> INPUT</h2>
                <div class="panel-content">
                    <textarea id="jsonInput" placeholder='Paste JSON, XML, or CSV data here...&#10;&#10;JSON: {"key": "value"}&#10;XML: <root><item>data</item></root>&#10;CSV: name,age,city&#10;     John,30,NYC' style="flex: 1; resize: none;"></textarea>

                    <div style="display: flex; gap: 6px; margin-top: 8px;">
                        <input type="file" id="fileInput" accept=".json,.xml,.csv,.txt" style="flex: 1; padding: 6px 8px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); border-radius: 4px; font-size: 12px; cursor: pointer;" />
                        <button class="btn-primary" onclick="parseJSON()">Parse</button>
                        <button class="btn-secondary" onclick="clearInput()">Clear</button>
                    </div>
                </div>
            </div>

            <!-- Configuration Panel -->
            <div class="panel" id="configPanel">
                <h2><span class="section-icon"></span> CHOOSE COLUMNS</h2>

                <div class="panel-content">
                    <div id="columnSelector" class="column-selector hide" style="display: flex; flex-direction: column;">
                        <div class="button-group">
                            <button class="btn-secondary btn-sm" onclick="selectAllColumns()">All</button>
                            <button class="btn-secondary btn-sm" onclick="deselectAllColumns()">None</button>
                        </div>
                        <div id="columnList" class="column-list" style="max-height: 200px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>

            <!-- Filter Panel -->
            <div class="panel">
                <h2><span class="section-icon"></span> FILTER</h2>
                <div class="panel-content">
                    <div id="filterControls" class="filter-controls hide">
                        <div id="filterList"></div>
                        <div style="display: flex; gap: 6px;">
                            <button class="btn-primary" id="applyFilterBtn" onclick="applyFilters()" style="display: none;">Apply</button>
                            <button class="btn-secondary" onclick="addFilterRow()">+ Add</button>
                        </div>
                    </div>

                    <div class="stats" id="statsContainer" style="display: none;">
                        <div class="stat-card">
                            <div class="stat-value" id="statRows">0</div>
                            <div class="stat-label">Rows</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statColumns">0</div>
                            <div class="stat-label">Cols</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statFiltered">0</div>
                            <div class="stat-label">View</div>
                        </div>
                    </div>

                    <div id="detailsStatusMessage" class="status-message"></div>

                    <div id="detailsEmpty" style="color: var(--text-secondary); font-size: 12px; padding: 12px; text-align: center;">
                        Parse JSON to see details
                    </div>
                </div>
            </div>
        </div>

        <!-- Output Section -->
        <div class="section-header">
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 8px 12px;">
                <h2 style="margin: 0; font-size: 12px; color: var(--accent-primary); text-transform: uppercase;"><span class="section-icon"></span> OUTPUT</h2>
                <button class="toggle-text-btn" id="outputSectionToggle" onclick="toggleOutputSection()">Hide Section</button>
            </div>
        </div>

        <div class="panel" id="outputPanel">
            <div class="panel-content" id="outputContent">
                <div class="search-filter-container">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Search..." onkeyup="applySearch()">
                    </div>
                    <div class="button-group">
                        <button class="btn-secondary" onclick="exportToCSV()">CSV</button>
                        <button class="btn-secondary" onclick="exportToJSON()">JSON</button>
                    </div>
                </div>

                <div id="tableContainer" class="table-wrapper hide">
                    <table id="dataTable">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>

                <div id="noData" class="no-data hide">
                    <p>No data. Parse JSON to start.</p>
                </div>
            </div>
        </div>

        <!-- Query Section -->
        <div class="section-header">
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 8px 12px;">
                <h2 style="margin: 0; font-size: 12px; color: var(--accent-primary); text-transform: uppercase;"><span class="section-icon"></span> QUERY</h2>
                <button class="toggle-text-btn" id="querySectionToggle" onclick="toggleQuerySection()">Hide Section</button>
            </div>
        </div>

        <div class="panel" style="min-height: 50px;" id="queryPanel">
            <div class="panel-content" id="queryContent">
                <div id="pgliteNotReady" style="text-align: center; color: var(--text-secondary); padding: 12px; font-size: 12px;">
                    Parse JSON to enable queries
                </div>

                <div id="querySection" class="hide">
                    <!-- Query Mode Selector -->
                    <div style="display: flex; gap: 8px; margin-bottom: 12px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px;">
                        <button class="query-mode-btn active" onclick="switchQueryMode('sql')" data-mode="sql">SQL</button>
                        <button class="query-mode-btn" onclick="switchQueryMode('jsonpath')" data-mode="jsonpath">JSONPath</button>
                    </div>

                    <!-- SQL Query Interface -->
                    <div id="sqlSection" class="query-mode-section">
                        <div style="display: flex; gap: 6px; margin-bottom: 8px; align-items: flex-start;">
                            <div style="flex: 1;">
                                <textarea id="sqlQuery" class="query-input" placeholder="SELECT * FROM json_data LIMIT 10;"></textarea>
                                <div style="margin-top: 6px; font-size: 11px; color: var(--text-secondary);">
                                    <details style="cursor: pointer;">
                                        <summary style="user-select: none;">Examples & Help</summary>
                                        <div style="margin-top: 8px; padding: 8px; background: var(--bg-tertiary); border-radius: 4px; line-height: 1.6;">
                                            <div><strong>Basic Queries:</strong></div>
                                            <div><code>SELECT * FROM json_data LIMIT 10</code> - First 10 rows</div>
                                            <div><code>SELECT name, email FROM json_data</code> - Specific columns</div>
                                            <div><code>SELECT COUNT(*) FROM json_data</code> - Count rows</div>
                                            <div style="margin-top: 8px;"><strong>Filtering:</strong></div>
                                            <div><code>SELECT * FROM json_data WHERE salary > 90000</code> - Filter by salary</div>
                                            <div><code>SELECT * FROM json_data WHERE department = 'Engineering'</code> - Filter by text</div>
                                            <div><code>SELECT * FROM json_data WHERE name LIKE '%son'</code> - Pattern matching</div>
                                            <div style="margin-top: 8px;"><strong>Aggregations:</strong></div>
                                            <div><code>SELECT department, AVG(salary) FROM json_data GROUP BY department</code> - Average by group</div>
                                            <div><code>SELECT department, COUNT(*) FROM json_data GROUP BY department</code> - Count by group</div>
                                            <div style="margin-top: 8px;"><strong>Sorting:</strong></div>
                                            <div><code>SELECT * FROM json_data ORDER BY salary DESC</code> - Sort descending</div>
                                            <div><code>SELECT * FROM json_data ORDER BY name ASC</code> - Sort ascending</div>
                                        </div>
                                    </details>
                                </div>
                            </div>
                            <button class="btn-primary" onclick="executeSQLQuery()" title="Execute query (Ctrl+Enter)" style="height: auto; padding: 8px 12px;">Execute</button>
                        </div>
                    </div>

                    <!-- JSONPath Query Interface -->
                    <div id="jsonpathSection" class="query-mode-section hide">
                        <div style="display: flex; gap: 6px; margin-bottom: 8px; align-items: flex-start;">
                            <div style="flex: 1;">
                                <textarea id="jsonpathQuery" class="query-input" placeholder="$.users[?(@.salary > 90000)]"></textarea>
                                <div style="margin-top: 6px; font-size: 11px; color: var(--text-secondary);">
                                    <details style="cursor: pointer;">
                                        <summary style="user-select: none;">Examples & Help</summary>
                                        <div style="margin-top: 8px; padding: 8px; background: var(--bg-tertiary); border-radius: 4px; line-height: 1.6;">
                                            <div><code>$.users[*]</code> - All users</div>
                                            <div><code>$..name</code> - All name properties (deep scan)</div>
                                            <div><code>$.users[0]</code> - First user</div>
                                            <div><code>$.users[-1]</code> - Last user</div>
                                            <div><code>$.users[0:3]</code> - First 3 users</div>
                                            <div><code>$.users[?(@.salary > 90000)]</code> - Filter by salary</div>
                                            <div><code>$.users[?(@.department === 'Engineering')]</code> - Filter by department</div>
                                            <div><code>$.users[*].name</code> - All user names</div>
                                        </div>
                                    </details>
                                </div>
                            </div>
                            <button class="btn-primary" onclick="executeJSONPathQuery()" title="Execute query (Ctrl+Enter)" style="height: auto; padding: 8px 12px;">Execute</button>
                        </div>
                    </div>

                    <!-- Query Error Display -->
                    <div id="queryError" class="hide" style="color: #ff4444; background: rgba(255, 68, 68, 0.1); padding: 8px 12px; margin-bottom: 8px; border-radius: 4px; font-size: 12px; border-left: 3px solid #ff4444;"></div>

                    <!-- Query Result Display -->
                    <div id="queryResult" class="query-result hide">
                        <div id="resultContent"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-message">
                If this tool saved your day or helped you out, consider buying me a coffee. Your support means a lot!
            </div>
            <div class="footer-buttons">
                <a href="https://www.buymeacoffee.com/dineshd" target="_blank">
                    <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee">
                </a>
            </div>
            <div style="margin-top: 8px; font-size: 11px; color: var(--text-secondary);">
                <a href="https://github.com/dinesh-it/queryjson" target="_blank" style="color: var(--accent-primary); text-decoration: none;">View on GitHub</a>
                |
                <a href="docs/ROADMAP.md" target="_blank" style="color: var(--accent-primary); text-decoration: none;">Roadmap</a>
                |
                <a href="LICENSE" target="_blank" style="color: var(--accent-primary); text-decoration: none;">MIT License</a>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="static/js/app.js"></script>
</body>
</html>
